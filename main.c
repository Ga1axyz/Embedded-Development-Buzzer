#include "sys.h"
#include "delay.h"
#include "timer.h"
#include "bz.h"
#include "key.h"
#include "led.h"

// Reference:  https://www.cnblogs.com/hicjiajia/archive/2012/03/31/2426339.html

/*


u8 music[] ={    				//音乐代码，歌曲为《漠河舞厅》，格式为: 音符, 节拍, 音符, 节拍,    
0x16,0x10,0x16,0x10,	  //音符的十位代表是低八度，中八度还是高八度，1代表低八度，2代表中八度，3代表高八度
0x16,0x10,0x17,0x10,	  //个位代表简谱的音符，例如0x15代表低八度的S0，0x21代表中八度的DO。
0x21,0x10,0x22,0x10,	  //节拍则是代表音长，例如：0x20代表一拍，0x40代表两拍，0x10代表1/2拍
0x23,0x10,0x21,0x10,		//1			我从没见过极光
0x23,0x10,0x23,0x10,
0x23,0x10,0x25,0x10,
0x23,0x20,0x66,0x10,
0x23,0x10,0x23,0x10,		// 2		出现的村落	也没
0x22,0x10,0x22,0x10,
0x22,0x10,0x23,0x10,
0x24,0x20,0x66,0x10,
0x66,0x10,0x16,0x10,		// 3		有见过有人	在
0x23,0x10,0x23,0x10,
0x23,0x10,0x22,0x10,
0x17,0x20,0x66,0x10,
0x66,0x10,0x66,0x10,		// 4		深夜放烟火
0x16,0x10,0x17,0x10,
0x21,0x10,0x22,0x10,
0x23,0x20,0x21,0x10,
0x23,0x10,0x21,0x10,		// 5		晚星就像你的眼睛
0x23,0x10,0x23,0x10,
0x23,0x10,0x25,0x10,
0x23,0x20,0x66,0x10,
0x23,0x10,0x23,0x10,		// 6		杀人又放火	你什
0x22,0x10,0x22,0x10,
0x22,0x10,0x23,0x10,
0x24,0x20,0x66,0x10,
0x66,0x10,0x66,0x10,		// 7		么都没有说
0x15,0x10,0x23,0x10,
0x23,0x10,0x22,0x10,
0x17,0x20,0x66,0x10,
0x66,0x10,0x66,0x10,		// 8		野风惊扰我
0x26,0x20,0x66,0x10,
0x23,0x10,0x21,0x10,
0x66,0x10,0x21,0x10,
0x25,0x10,0x24,0x20,
0x23,0x10,0x24,0x20,
0x66,0x10,0x66,0x10,		// 9		三千里	偶然见过你
0x25,0x20,0x66,0x10,
0x22,0x10,0x17,0x10,
0x66,0x10,0x17,0x10,
0x25,0x10,0x23,0x20,
0x24,0x10,0x23,0x20,
0x66,0x10,0x66,0x10,		// 10		花园里	有裙翩舞起
0x26,0x20,0x23,0x10,
0x21,0x10,0x21,0x10,
0x66,0x10,0x21,0x10,
0x25,0x10,0x24,0x20,
0x23,0x10,0x24,0x20,
0x66,0x10,0x24,0x10,		// 11		灯光底	抖落了晨曦
0x23,0x10,0x24,0x10,
0x23,0x10,0x24,0x10,
0x24,0x10,0x23,0x10,
0x24,0x10,0x23,0x10,
0x66,0x10,0x23,0x10,
0x66,0x20,0x66,0x20,		// 12		在1980的漠河舞厅
0x00,0x00,0xff
};
*/

/*



u8 music[] ={    				//音乐代码，歌曲为《这世界那么多人》，格式为: 音符, 节拍, 音符, 节拍,    no sustain -

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x26,0x20,	0x25,0x10,
0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x20,  0x16,0x20,  0x21,0x20,
	
0x88,0x20,	0x88,0x20,	0x88,0x10,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x20,  0x21,0x10,  0x22,0x10,  0x23,0x10,  0x25,0x10,  0x26,0x20,  0x25,0x10,
0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x10,  0x15,0x10,  0x22,0x20,	0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x25,0x20,  0x22,0x10,  0x23,0x20,  0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x10,  0x16,0x20,	0x25,0x20,  0x22,0x20,
0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x21,0x10,  0x26,0x10,  0x26,0x10,  0x31,0x10,  0x23,0x20,
0x88,0x10,
0x25,0x10,  0x23,0x10,  0x22,0x20,
0x88,0x10,
0x21,0x10,  0x22,0x10,  0x23,0x10,	0x26,0x20,  0x25,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x26,0x10,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x25,0x10,  0x23,0x10,  0x22,0x20,  0x21,0x20,  0x16,0x10,  0x21,0x10,  0x25,0x10,	0x23,0x10,  0x22,0x20,
0x88,0x20,
0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x32,0x10,  0x31,0x20,
0x88,0x20,
0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,	0x25,0x10,  0x23,0x10,	0x22,0x20,  0x21,0x10,  0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x20,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x20,  0x21,0x10,  0x22,0x10,  0x23,0x10,  0x25,0x10,  0x26,0x20,  0x25,0x10,
0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x10,  0x15,0x10,  0x22,0x20,	0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x25,0x20,  0x22,0x10,  0x23,0x20,  0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x10,  0x16,0x20,	0x25,0x20,  0x22,0x20,
0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x21,0x10,  0x26,0x10,  0x26,0x10,  0x31,0x10,  0x23,0x20,
0x88,0x10,
0x25,0x10,  0x23,0x10,  0x22,0x20,
0x88,0x10,
0x21,0x10,  0x22,0x10,  0x23,0x10,	0x26,0x20,  0x25,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x26,0x10,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x25,0x10,  0x23,0x10,  0x22,0x20,  0x21,0x20,  0x16,0x10,  0x21,0x10,  0x25,0x10,	0x23,0x10,  0x22,0x20,
0x88,0x20,
0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x32,0x10,  0x31,0x20,
0x88,0x20,
0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,	0x25,0x10,  0x23,0x10,	0x22,0x20,  0x21,0x10,  0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,  0x26,0x10,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x25,0x10,  0x23,0x10,  0x22,0x20,  0x21,0x20,  0x16,0x10,  0x21,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x20,
0x88,0x20,
0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,  0x32,0x10,  0x31,0x20,
0x88,0x20,
0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x25,0x10,  0x23,0x10,	0x22,0x20,  0x21,0x10,  0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x21,0x10,	0x22,0x10,  0x23,0x10,  0x25,0x10,  0x26,0x20,  0x25,0x10,
0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x20,  0x16,0x10,  0x21,0x10,	0x21,0x20,

0x00,0x00,0xff

};
*/





u8 music1[] ={    				//音乐代码，歌曲为《这世界那么多人》，格式为: 音符, 节拍, 音符, 节拍,    no sustain -

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x26,0x20,	0x25,0x10,
0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x20,  0x16,0x20,  0x21,0x20,
	
0x88,0x20,	0x88,0x20,	0x88,0x10,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x20,  0x21,0x10,  0x22,0x10,  0x23,0x10,  0x25,0x10,  0x26,0x20,  0x25,0x10,
0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x10,  0x15,0x10,  0x22,0x20,	0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x25,0x20,  0x22,0x10,  0x23,0x20,  0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x10,  0x16,0x20,	0x25,0x20,  0x22,0x20,
0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x21,0x10,  0x26,0x10,  0x26,0x10,  0x31,0x10,  0x23,0x20,
0x88,0x10,
0x25,0x10,  0x23,0x10,  0x22,0x20,

0xf1
};

u8 music2[] ={
0x88,0x10,
0x21,0x10,  0x22,0x10,  0x23,0x10,	0x26,0x20,  0x25,0x20,
	
0x88,0x20,	0x88,0x20,	0x88,0x10,

0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x26,0x10,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x25,0x10,  0x23,0x10,  0x22,0x20,  0x21,0x20,  0x16,0x10,  0x21,0x10,  0x25,0x10,	0x23,0x10,  0x22,0x20,
0x88,0x20,
0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x32,0x10,  0x31,0x20,
0x88,0x20,
0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,	0x25,0x10,  0x23,0x10,	0x22,0x20,  0x21,0x10,  0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x20,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x20,  0x21,0x10,  0x22,0x10,  0x23,0x10,  0x25,0x10,  0x26,0x20,  0x25,0x10,
0x88,0x20,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x10,  0x15,0x10,  0x22,0x20,	0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0xf2
};

u8 music3[] ={
0x25,0x20,  0x22,0x10,  0x23,0x20,  0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x10,  0x16,0x20,	0x25,0x20,  0x22,0x20,
0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,  0x22,0x20,  0x25,0x20,
0x88,0x20,
0x21,0x10,  0x26,0x10,  0x26,0x10,  0x31,0x10,  0x23,0x20,
0x88,0x10,
0x25,0x10,  0x23,0x10,  0x22,0x20,
0x88,0x10,
0x21,0x10,  0x22,0x10,  0x23,0x10,	0x26,0x20,  0x25,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x26,0x10,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x25,0x10,  0x23,0x10,  0x22,0x20,  0x21,0x20,  0x16,0x10,  0x21,0x10,  0x25,0x10,	0x23,0x10,  0x22,0x20,
0x88,0x20,
0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,	0x32,0x10,  0x31,0x20,
0x88,0x20,
0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,	0x25,0x10,  0x23,0x10,	0x22,0x20,  0x21,0x10,  0x21,0x20,

0x88,0x20,	0x88,0x20,	0x88,0x10,

0xf3
};

u8 music4[] ={
0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,  0x26,0x10,  0x25,0x20,
0x88,0x20,
0x26,0x20,  0x25,0x10,  0x23,0x10,  0x22,0x20,  0x21,0x20,  0x16,0x10,  0x21,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x20,
0x88,0x20,
0x23,0x20,  0x25,0x10,  0x31,0x10,  0x32,0x20,  0x33,0x20,  0x21,0x10,  0x23,0x10,  0x31,0x10,  0x32,0x10,  0x31,0x20,
0x88,0x20,
0x31,0x10,  0x26,0x10,  0x25,0x10,  0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x25,0x10,  0x23,0x10,	0x22,0x20,  0x21,0x10,  0x21,0x20,
	
0x88,0x20,	0x88,0x20,	0x88,0x10,

0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x22,0x20,  0x23,0x10,  0x25,0x10,  0x23,0x20,
0x88,0x20,	0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x21,0x10,  0x16,0x10,  0x21,0x20,  0x16,0x10,	0x15,0x20,
0x88,0x20,	0x88,0x20,
0x15,0x10,  0x21,0x20,  0x21,0x10,  0x21,0x10,  0x21,0x10,	0x22,0x10,  0x23,0x10,  0x25,0x10,  0x26,0x20,  0x25,0x10,
0x88,0x10,
0x23,0x10,  0x22,0x10,  0x21,0x20,
0x88,0x10,
0x16,0x10,  0x15,0x20,  0x16,0x10,  0x21,0x10,	0x21,0x20,

0x00
};

/*

u16 quzi[] ={	  //此数组数据为各个音符在定时器中的重装值，第一列是高位，第二列是低位
		0xf88b,	  //低八度，低1
		0xf95b,	  
		0xfa14,	  //低3
		0xfa66,
		0xfb03,	  //低5
		0xfb8f,
		0xfc0b,	  //低7	
		0xfc43,	  //中央 C 调
		0xfcab,	  //中2
		0xfd08,
		0xfd33,	  //中4
		0xfd81,
		0xfdc7,	  //中6
		0xfe05,
		0xfe21,	  //高八度，高1	
		0xfe55,
		0xfe84,	  //高3
		0xfe99,
		0xfec0,	  //高5
		0xfee3,
		0xff02	  //高7
};
*/
u16 quzi[] ={	  //此数组数据为各个音符在定时器中的重装值，第一列是高位，第二列是低位
		0xF922 ,	  //低八度，低1
		0xF9E2,	  
		0xFA8C,	  	//低3
		0xFAD9,
		0xFB69,	  	//低5
		0xFBE9,
		0xFC5C,	  	//低7	
	
		0xFC8F,	  	//中央 C 调
		0xFCF0,	  	//中2
		0xFD46,
		0xFD6D,	  	//中4
		0xFDB5,
		0xFDF5,	  	//中6
		0xFE2E,
	
		0xFE48,	  	//高八度，高1	
		0xFE79,
		0xFEA3,	  	//高3
		0xFEB7,
		0xFEDB,	  	//高5
		0xFEFB,
		0xFF16	  	//高7
};

int main( void )
{
 	u8 p, m, tem, pos; 							// m为节拍
 	u8 i = 0, key = 0,flag = 0;
	Stm32_Clock_Init( 6 );  				// 6倍频
	delay_init( 72 ); 							// 12M外部晶振
	KeyInit();
	BzInit();
	Timer3Init( 71 ); 							// 1M
	LED_Init();
	LED_SEL = 0;
	
	while( 1 )
	{
		if(flag == 0)
			p = music1[i];
		if(flag == 1)
			p = music2[i];
		if(flag == 2)
			p = music3[i];
		if(flag == 3)
			p = music4[i];
		
		if( p==0xf1 )
		{
			flag = 1;
			i = 0;
			continue;
		}
		else if( p==0xf2 )
		{
			flag = 2;
			i = 0;
			continue;
		}
		else if( p==0xf3 )
		{
			flag = 3;
			i = 0;
			continue;
		}
		
		//p = music[i]; 								// 如果碰到结束符，延时1秒,回到开始再来一遍 
		if( p==0x00 )
		{
			i = 0;
			TIM3->CR1&= ~(0x01);    		//关闭定时器3
		}
		else if( p==0xff ) 						// 若碰到休止符,延时100ms,继续取下一音符
		{
			i = i + 2;
			delay_ms(100);
			TIM3->CR1&= ~(0x01);    		// 关闭定时器3
		}
		else 													// 正常情况下取音符和节拍 
		{
			if(p != 0x88){
				if(flag == 0)
					tem = QuYin( music1[i] );
				if(flag == 1)
					tem = QuYin( music2[i] );
				if(flag == 2)
					tem = QuYin( music3[i] );
				if(flag == 3)
					tem = QuYin( music4[i] );
				//tem = QuYin( music[i] ); 	// 取出当前音符在quzi数组中的位置值
				TIM3->ARR = 0xffff-quzi[tem]; 	
			}
			else{
				TIM3->ARR = 0;
			}
			i++;
			if(flag == 0)
				m = music1[i];
			if(flag == 1)
				m = music2[i];
			if(flag == 2)
				m = music3[i];
			if(flag == 3)
				m = music4[i];
			//m = music[i]; 							// 取得节拍
			i++;
			delay_ms(62);
		}
		TIM3->CR1 |= 0x01;    				// 使能定时器3
		
		pos = p;
		p &= 0xf;
		pos /= 16;
		
		
		//SetLed(0,p);									// LED 闪烁相应的简谱
		SetLed(pos,p);									// 数码管 闪烁相应的简谱
		
		delay_ms(m*24);
		TIM3->CR1 &=  ~(0x01);    //关闭定时器3
	}
}


